/**
 *
 *
 * @author Josh Lobe
 * http://ultimatetinymcepro.com
 
 * CodeMagic is a replacement source code editor plugin for Tinymce which integrates the CodeMirror (http://www.codemirror.net/) library for syntax highlighting.  
 * Adapted to eXeLearning by Ignacio Gros (http://gros.es/)
 * Compare this file with plugin.js to see what's different (we use eXe's _ function to translate the strings, etc.).
 */

jQuery(document).ready(function ($) {

	tinymce.PluginManager.add('codemagic', function (editor, url) {

		// This could be in langs/all.js
		// For that, you'll have to add this line before tinymce.PluginManager.add...:
		// tinymce.PluginManager.requireLangPack('codemagic');
		tinymce.addI18n('all', {
			'Edit source code': _('Edit source code'),
			'Wrap text': _('Wrap text'),
			'Auto completion': _('Auto close tags'),
			'Highlight Code': _('Highlight syntax'),
			'Undo': _('Undo'),
			'Redo': _('Redo'),
			'Search and Replace': _('Search and Replace'),
			'Search': _('Search'),
			'Replace': _('Replace'),
			'Cancel': _('Cancel'),
			'Insert and Close': _('Update'),
			'Reformat': _('Reformat'),
			'Format HTML Code': _('Format HTML Code'),
			'Full Screen': _('Full Screen')
		});

		editor.ui.registry.addIcon('html', `
		<?xml version="1.0" encoding="utf-8"?>
		<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
		<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
			 width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
		<desc>Created with Sketch.</desc>
		<g>
			<polygon points="5.182,12.996 6.224,12.996 6.224,14.996 7.224,14.996 7.224,9.995 6.224,9.995 6.224,11.996 5.182,11.996 
				5.182,9.995 4.182,9.995 4.182,14.996 5.182,14.996 	"/>
			<polygon points="10.182,14.996 10.182,10.995 11.182,10.995 11.182,9.995 10.182,9.995 9.182,9.995 8.182,9.995 8.182,10.995 
				9.182,10.995 9.182,14.996 	"/>
			<polygon points="17.182,14.996 17.182,10.995 17.182,10.995 17.182,9.995 17.182,9.995 16.182,9.995 15.16,9.995 14.16,9.995 
				13.191,9.995 12.192,9.995 12.191,9.995 12.191,14.996 13.191,14.996 13.191,10.995 14.16,10.995 14.16,14.996 15.16,14.996 
				15.16,10.995 16.182,10.995 16.182,14.996 	"/>
			<polygon points="19.202,13.996 19.202,9.995 18.202,9.995 18.202,14.996 18.296,14.996 19.202,14.996 20.201,14.996 20.201,13.996 
					"/>
			<rect x="4.191" y="6.037" width="16" height="3"/>
			<rect x="4.191" y="16.057" width="16" height="3"/>
		</g>
		</svg>`);
		editor.ui.registry.addButton('codemagic', {
			icon: "html",
			tooltip: _('Edit source code') + " (" + _('advanced editor') + ")",
			onAction: open_codemagic
		});

		editor.ui.registry.addMenuItem('codemagic', {
			icon: 'html',
			text: _('Edit source code') + " (" + _('advanced editor') + ")",
			onAction: open_codemagic,
			context: 'tools'
		});

		function open_codemagic() {
			codemagicDialog = editor.windowManager.openUrl({
				title: _('Edit source code'),
				width: 900,
				height: 650,
                // maximizable: true,
				url: url+'/codemagic.html'
			});
		}

	});
});